<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Demo TrackIt Suite</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center p-8">
  <div class="bg-white shadow-lg rounded-2xl p-8 w-full max-w-lg text-center">
    <h1 class="text-3xl font-bold text-gray-800 mb-6">ğŸš€ TrackIt Suite SDK Demo</h1>
    <p class="text-gray-600 mb-8">Usa los botones para probar las funciones principales</p>

    <div class="flex flex-col gap-3">
     <h2>RRWeb Recording</h2>
      <button id="openNPS" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-3 rounded-lg transition">â–¶ï¸ Abrir NPS</button>
    

      <h2>RRWeb Recording</h2>
      <button id="btnStartRecording" class="bg-green-500 hover:bg-green-600 text-white font-semibold py-3 rounded-lg transition">â–¶ï¸ Iniciar grabaciÃ³n</button>
      <button id="btnPauseRecording" class="bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-3 rounded-lg transition">â¸ï¸ Pausar grabaciÃ³n</button>
      <button id="btnStopRecording" class="bg-red-500 hover:bg-red-600 text-white font-semibold py-3 rounded-lg transition">â¹ï¸ Detener y enviar</button>
      <button id="btnShowEvents" class="bg-blue-500 hover:bg-blue-600 text-white font-semibold py-3 rounded-lg transition">ğŸ“¦ Ver eventos acumulados</button>

      <h2>Errores</h2>
      <button id="btnError" class="bg-red-500 hover:bg-red-600 text-white font-semibold py-3 rounded-lg transition">ğŸ”¥ Lanzar error manual</button>
      <button id="btnConsole" class="bg-yellow-500 hover:bg-yellow-600 text-white font-semibold py-3 rounded-lg transition">âš ï¸ Lanzar console.error</button>
      <button id="btnPromise" class="bg-orange-500 hover:bg-orange-600 text-white font-semibold py-3 rounded-lg transition">ğŸŒ€ Lanzar error en promesa</button>
    </div>

    <p class="text-sm text-gray-400 mt-6">Abre la consola del navegador para ver los logs.</p>
  </div>

  <!-- Importa el bundle UMD -->
  <script src="./dist/chikavi-tracking.umd.js"></script>
  <script>
    // ğŸ”¹ Instancia del SDK
    const sdk = new TrackItSuite({
      projectId: "demo-123",
      publicToken: "demo-token"
    });

    // ğŸ”¹ TrackerManager
    const tracker = new TrackerManager({
      userId: "test-user",
      onEvent: (e) => console.log("Evento grabado:", e)
    });

    window.tracker = tracker; // debug

    // === Botones de prueba ===
    document.getElementById("btnStartRecording").onclick = () => {
      tracker.startRecording();
      console.log('âœ… GrabaciÃ³n iniciada');
    };

    document.getElementById("btnPauseRecording").onclick = () => {
      tracker.rrwebTracker?.stop();
      console.log('â¸ï¸ GrabaciÃ³n pausada');
    };

    document.getElementById("btnStopRecording").onclick = async () => {
      await tracker.stopRecording(); // envÃ­a datos al backend
      console.log('â¹ï¸ GrabaciÃ³n detenida y sesiÃ³n enviada');
      tracker.rrwebTracker?.clear(); // limpia eventos
    };

    document.getElementById("btnShowEvents").onclick = () => {
      console.log('ğŸ“¦ Eventos acumulados:', tracker.getSessionJSON());
    };
    

    // Errores
    document.getElementById("btnError").onclick = () => { throw new Error("Error manual lanzado con throw!"); };
    document.getElementById("btnConsole").onclick = () => { console.error("Esto es un error capturado desde console.error"); };
    document.getElementById("btnPromise").onclick = () => { Promise.reject(new Error("Promesa rechazada sin catch")); };

    // Enviar sesiÃ³n automÃ¡ticamente al cerrar pestaÃ±a
    window.addEventListener("beforeunload", async () => {
      await tracker.stopRecording();
    });
  </script>
</body>
</html>
